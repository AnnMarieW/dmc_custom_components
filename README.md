# Custom Components for Dash Mantine Components.

## Introduction

This project shows how to create custom Dash components that use Mantine components or Mantine hooks as dependencies, such as custom Mantine `Select` components.

It includes two example components based on Mantine’s `Select` examples from the [Combobox examples page](https://mantine.dev/combobox/?e=BasicSelect).

## Project Setup

The project was started using Plotly's [Dash Typescript Component Template](https://github.com/plotly/dash-typescript-component-template).
This template provides the standard structure and build pipeline for creating Dash components with React and TypeScript, along with the generated Python API.

## Version Requirements

* This project must be built using the same Mantine version as the `dash-mantine-components` version in the Dash app.
* Requires dash-mantine-components ≥ 2.5.0
* Supported Mantine packages:
  * Mantine Core
  * Mantine Hooks
  * Mantine Dates
* Other Mantine packages are not supported

Using mismatched Mantine versions may cause runtime errors.

## Why a Wrapper Is Used

Dash Mantine Components ≥ 2.5.0 exposes Mantine Core, Mantine Hooks, and Mantine Dates on the global `window` object.
A wrapper is used to ensure these APIs are fully loaded before a custom component is rendered.  It also makes it so that
your custom component does not need it's own `MantineProvider`.  

You can find the wrapper in the [utils folder](https://github.com/AnnMarieW/dmc_custom_components/blob/main/src/ts/utils/withMantine.tsx)

See the sample dash app [usage.py](https://github.com/AnnMarieW/dmc_custom_components/blob/main/usage.py)

## Updating webpack

To utilize in custom components, you need to place this in your `webpack.config.js` `externals`:

```
         '@mantine/core': {
            commonjs: '@mantine/core',
            commonjs2: '@mantine/core',
            amd: '@mantine/core',
            root: 'MantineCore', // This maps to window.MantineCore
        },
        '@mantine/hooks': {
            commonjs: '@mantine/hooks',
            commonjs2: '@mantine/hooks',
            amd: '@mantine/hooks',
            root: 'MantineHooks', // This maps to window.MantineHooks
        },
        '@mantine/dates': {
            commonjs: '@mantine/dates',
            commonjs2: '@mantine/dates',
            amd: '@mantine/dates',
            root: 'MantineDates', // This maps to window.MantineDates
        },
```
--------------------

The following is automatically generated by the Dash Typescript Template:
## Install

```shell
pip install dmc_custom_components
```

## Development
### Getting Started

1. Create a new python environment:
   ```shell
   python -m venv venv
   . venv/bin/activate
   ```
   _Note: venv\Scripts\activate for windows_

2. Install python dependencies:
   ```shell
   pip install -r requirements.txt
   ```
3. Install npm packages:
   1. Optional: use [nvm](https://github.com/nvm-sh/nvm) to manage node version:
      ```shell
      nvm install
      nvm use
      ```
   2. Install:
      ```shell
      npm install
      ```
4. Build:
   ```shell
   npm run build
   ```


### Create a production build and publish:

1. Clean up build and  dist - removes old and temp tarballs:
```
rm -rf dist build
```


2. Run a new build
```
npm install
npm run build
```

3. Build source distribution.  
```
npm run dist
```

4. Test your tarball by copying it into a new environment and installing it locally, for example:
```
pip install <your-project-name-version>.tar.gz
```

Note:  For local install, use:

```
pip install -e ./path-to-project
```


5. Publish on PyPI

Prepare release on the GitHub UI - For more information see [Managing Releases](https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository)
When in doubt, do an alpha release first
```
$ twine upload dist/*
```
6. If publish on npm:

Note: Publishing your component to NPM will make the JavaScript bundles available on the unpkg CDN. By default, Dash serves the component library's CSS and JS locally, but if you choose to publish the package to NPM you can set `serve_locally` to `False` and you may see faster load times.
```
npm publish
``` 


### Justfile

Alternatively, use the provided [just](https://github.com/casey/just) commands:

1. Create a Python environment from previous step 1 and install:
   ```shell
   just install
   ```
2. Build
   ```shell
   just build
   ```
3. Publish
   ```shell
   just publish
   ```
4. See all commands with `just -l`
